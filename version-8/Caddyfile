# Simple Todo App - Caddy Configuration
# Reverse proxy with static file serving and metrics access

:80 {
    # Health check endpoint for the proxy itself
    handle /proxy-health {
        respond "OK" 200
    }

    # Serve static files directly from the mounted volume
    handle_path /static/* {
        root * /srv/static
        file_server
    }

    # Expose metrics endpoint (optional - for debugging through proxy)
    handle /metrics {
        reverse_proxy web:5000
    }

    # Forward all other requests to the Flask app
    reverse_proxy web:5000 {
        # Health check for upstream
        health_uri /healthz
        health_interval 30s
        health_timeout 5s
    }

    # Enable request logging
    log {
        output stdout
        format console
    }
}
